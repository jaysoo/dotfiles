<h1>[["QUOTING_HDR|Quote" | i18n]]</h1>

<div ng-controller="QuoteCtrl as quoteCtrl">
  <div ng-if="quoteCtrl.mode == 'show'">
    <div ng-include="'quoting/quote_details'"></div>
  </div>
  <div ng-if="quoteCtrl.mode == 'edit'">
    <div ng-include="'quoting/quote_form'"></div>
  </div>
</div>

<div ng-controller="QuoteChargeItemsCtrl as itemsCtrl">
    <table class="table">
        <thead>
        <tr>
            <th>[["QUOTING_ITEMS | Charge item" | i18n]]</th>
            <th>[["QUOTING_ITEMS | Category" | i18n]]</th>
            <th>[["QUOTING_ITEMS | Cost Per Unit" | i18n]]</th>
            <th>[["QUOTING_ITEMS | % Markup" | i18n]]</th>
            <th>[["QUOTING_ITEMS | Markup Per Unit" | i18n]]</th>
            <th>[["QUOTING_ITEMS | Charge Per Unit" | i18n]]</th>
            <th></th>
        </tr>
        </thead>

        <tfoot>
          <tr>
            <td colspan="7">&nbsp;</td>
          </tr>
          <tr>
            <td>[["QUOTING_ITEMS | Total" | i18n]]</td>
            <td></td>
            <td>[[itemsCtrl.totalCostPerUnit() | formatNumberLong]]</td>
            <td></td>
            <td></td>
            <td>[[itemsCtrl.totalChargePerUnit() | formatNumberLong]]</td>
          </tr>
        </tfoot>

        <tbody>
        <tr ng-controller="ChargeItemFormCtrl as itemCtrl"
            ng-init="itemCtrl.newItem(item)">
            <td><input type="text" ng-model="itemCtrl.item.name"></td>
            <td><input type="text" ng-model="itemCtrl.item.category"></td>
            <td><input type="number" ng-model="itemCtrl.item.costPerUnit"
                       ng-change="itemCtrl.onCostPerUnitChange()" nu-max-decimals="5"></td>
            <td><input type="number" ng-model="itemCtrl.item.percentageMarkup"
                       ng-change="itemCtrl.onPercentageMarkupChange()"></td>
            <td>[[itemCtrl.item.markupPerUnit | formatNumberLong]]</td>
            <td><input type="number" ng-model="itemCtrl.item.chargePerUnit"
                       ng-change="itemCtrl.onChargePerUnitChange()"></td>
            <td>
                <a href="#" data-icon="add" ng-click="itemCtrl.addChargeItem()"></a>
            </td>
        </tr>
        </tbody>
        <tbody ng-repeat="item in itemsCtrl.chargeItems">
        <tr ng-if="!itemsCtrl.isEditing(item)">
            <td>[[item.name]]</td>
            <td>[[item.category]]</td>
            <td>[[item.costPerUnit | formatNumberLong]]</td>
            <td>[[item.percentageMarkup | formatNumberLong]]</td>
            <td>[[item.markupPerUnit | formatNumberLong]]</td>
            <td>[[item.chargePerUnit | formatNumberLong]]</td>
            <td >
                <a href="#" data-icon="edit" ng-click="itemsCtrl.switchToEdit(item)"></a>
                <a href="#" data-icon="delete" ng-click="itemsCtrl.deleteChargeItem(item)"></a>
            </td>
        </tr>
        <tr ng-if="itemsCtrl.isEditing(item)" ng-controller="ChargeItemFormCtrl as itemCtrl"
                ng-init="itemCtrl.copyFrom(item)">
            <td><input type="text" ng-model="itemCtrl.item.name"></td>
            <td><input type="text" ng-model="itemCtrl.item.category"></td>
            <td><input type="number" ng-model="itemCtrl.item.costPerUnit"
                       ng-change="itemCtrl.onCostPerUnitChange()"></td>
            <td><input type="number" ng-model="itemCtrl.item.percentageMarkup"
                       ng-change="itemCtrl.onPercentageMarkupChange()"></td>
            <td>[[itemCtrl.item.markupPerUnit | formatNumberLong]]</td>
            <td><input type="number" ng-model="itemCtrl.item.chargePerUnit"
                       ng-change="itemCtrl.onChargePerUnitChange()"></td>
            <td>
                <a href="#" data-icon="save" ng-click="itemsCtrl.saveChargeItem(itemCtrl.item, item)"></a>
                <a href="#" data-icon="cancel" ng-click="itemsCtrl.switchToShow(item)"></a>
            </td>
        </tr>
        </tbody>
    </table>
</div>
