class AddIstoPermissions < ActiveRecord::Migration
  def up
    PgTools.public_schema_only do
      parent = Permission.find_by_controller_and_action('inbound_stock_transfer_orders', 'new') || create_parent_permission
      Permission.create({ controller: "inbound_stock_transfer_orders", action: "retrieve_finished_good", parent: parent})
    end
  end

  def down
    PgTools.public_schema_only do
      Permission.delete_all({controller: "inbound_stock_transfer_orders", action: "retrieve_finished_good"})
    end
  end

  def create_parent_permission
    Permission.create! controller: "inbound_stock_transfer_orders",
      action: "new",
      role_production: "manager"
  end
end
