require File.expand_path(File.dirname(__FILE__) + '/../test_helper')

class WorkflowsControllerTest < ActionController::TestCase

  def setup
    @user = login
    @site = @user.site
    @account = @site.account
  end

  def test_should_get_index_with_workflow
    @user.update_attributes! :role => User::LEAD, :financial_access => User::FINANCIAL_ACCESS_NONE
    @site.update_attributes! :workflow => Site::NONE[1]

    get :index
    assert_response :success
  end

  def test_should_not_get_index_account_not_active
    @user.update_attributes! :role => User::COMPANY_ADMIN
    @account.update_attributes! :active => false
    @site.update_attributes! :workflow => Site::NONE[1]

    get :index

    assert_response :redirect
    assert_redirected_to new_user_session_path
  end

  def test_should_not_get_index_customer_user
    customer = @account.customers.create! :name => "customer"

    @user.update_attributes! :role => User::CUSTOMER, :customer => customer, :financial_access => User::FINANCIAL_ACCESS_NONE
    @site.update_attributes! :workflow => Site::NONE[1]

    get :index

    assert_response :redirect
    assert_redirected_to no_access_page
  end
end
