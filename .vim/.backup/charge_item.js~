'use strict'
define("Quoting.ChargeItem", function(module) {
  function ChargeItem(attributes){
    _.bindAll(this)

    var attrs = _.isUndefined(attributes) ? {} : attributes
    _.defaults(attrs, {name: "", costPerUnit: 0, chargePerUnit: 0, percentageMarkup: 0})
    _.extend(this, _.pick(attrs, 'id', 'name', 'category', 'costPerUnit', 'chargePerUnit', 'percentageMarkup'))

    this._updateMarkupPerUnitAndChargePerUnit()
  }

  _.extend(ChargeItem.prototype, {
    onCostPerUnitChange: function(){
      this._updateMarkupPerUnitAndChargePerUnit()
    },

    onPercentageMarkupChange: function(){
      this._updateMarkupPerUnitAndChargePerUnit()
    },

    onChargePerUnitChange: function(){
      this._updateMarkupPerUnit()
      this.percentageMarkup = this.costPerUnit === 0 ? 0 : 100 * this.markupPerUnit / this.costPerUnit
    },

    _updateMarkupPerUnitAndChargePerUnit: function(){
      this.markupPerUnit = this.percentageMarkup / 100 * this.costPerUnit
      this.chargePerUnit = this.costPerUnit + this.markupPerUnit
    },

    _updateMarkupPerUnit: function(){
      this.markupPerUnit = this.chargePerUnit - this.costPerUnit
    }
  })

  module.exports = ChargeItem
})
